<script>    //muda o titulo da pag    $(document).ready(function () {        document.title = '<?php echo $titulo ?>';        $("#ingredientes").select2({            theme: "bootstrap",            language: "pt-BR",            minimumInputLength: 1,            minimumResultsForSearch: 10,            placeholder: 'Comece a escrever...',            ajax: {                url: '<?php echo site_url('inicio/exibirNome') ?>',                dataType: 'json',                delay: 250,                processResults: function (data) {                    return {                        results: data                    };                },                cache: true            }        });        $("#imagem").fileinput({            showCaption: false,            language: 'pt-BR'        });    });</script><div class="clearfix modal-body container_forms">    <h2>Nova Receita</h2>    <form id="receitasForm" enctype="multipart/form-data" action="<?php echo site_url('receitas/validar') ?>" method="post">        <div class="col-md-6">            <div class="col-md-12 group">                <input autofocus="autofocus" id="nome" name="nome" type="text" required="required">                <span class="highlight"></span>                <span class="bar"></span>                <label class="label-input">Nome *</label>            </div>            <div class="col-md-12 group">                <label style="color: #999; font-weight: normal; font-size:18px;">Ingredientes *</label>                <select style="width: 70%" id="ingredientes" name="ingredientes[]" multiple="multiple">                </select>            </div>            <div class="col-md-12 group">                <div>                    <label style="color: #999; font-weight: normal; font-size:18px;" class="control-label">Tempo de cozimento (minutos) *</label>                </div>                <div>                    <select class="selectpicker" name="tempocoz" id="tempocoz">                        <?php                        $counter = 1;                        while ($counter <= 120) {                            echo "<option value='$counter'>$counter</option>";                            $counter++;                        }                        ?>                    </select>                </div>            </div>            <div class="col-md-12 group">                <div>                    <label style="color: #999; font-weight: normal; font-size:18px;" class="control-label">Porções *</label>                </div>                <div>                    <select class="selectpicker" name="porcoes" id="porcoes">                        <?php                        $counter = 1;                        while ($counter <= 20) {                            echo "<option value='$counter'>$counter</option>";                            $counter++;                        }                        ?>                    </select>                </div>            </div>        </div>        <div class="col-md-6 group">            <div class="col-md-12">                <label style="color: #999; font-weight: normal; font-size:18px;" class="control-label">Imagem da receita *</label>                <input  id="imagem" name="imagem" type="file" >            </div>        </div>        <div class="col-md-12">            <div class="col-md-6 form-group">                <label style="color: #999; font-weight: normal; font-size:18px;" for="descricao">Breve descrição</label>                <textarea class="form-control" name="descricao" id="descricao" rows="3"></textarea>            </div>        </div>        <div class="col-md-12 form-group">            <div style="margin-top: 20px;">                <button id="clearbtn" class="btn btn-default" type="reset">Limpar</button>                <button id="save" style="background: #fc724c; border-color: #e26644" class="btn btn-success" >                    <img alt="" width="20" height="20" src="<?php echo base_url() ?>assets/img/loadwhite.svg" id="loading" style="display:none">                    <span id="enviar">Enviar</span>                </button>            </div>        </div>    </form></div><div id="tabelareceitas" style="z-index: 1; background: #F7F7F7">    <div class="table-responsive">        <table id="receitas" class="table table-hover" width="100%">            <thead>                <tr>                    <th></th>                    <th>Ilustração</th>                    <th>Nome</th>                    <th>Ingredientes</th>                    <th>Preparo (min)</th>                    <th>Porções</th>                    <th>Descrição</th>                </tr>            </thead>            <tbody>            </tbody>        </table>    </div></div><div id="excluirReceita" class="modal fade in" role="dialog">    <div class="modal-dialog modal-lg">        <div class="modal-content">            <div class="modal-header">                <button type="button" class="close" data-dismiss="modal">&times;</button>                <h2 class="modal-title">Você deseja realmente excluir esta(s) receita(s)?</h2>            </div>            <div class="clearfix modal-body container_forms">                <form id="excluirForm" action="<?php echo site_url('receitas/excluir') ?>" method="post">                    <div class="col-md-12">                        <div id="nomeExcluir" class="col-md-6">                            <ul></ul>                        </div>                        <input id="excluirinput" type="hidden" name="registrosexcluir">                    </div>                    <input id="acao" type="hidden" name="acao" value="excluir">                    <div class="col-md-10 col-md-offset-2" align="center">                        <button class="btn btn-default" data-dismiss="modal">Cancelar</button>                        <button id="excluirReceitabtn" style="background: #fc4c4c; border-color: #e24444" class="btn btn-success" >                            <img alt="" width="20" height="20" src="<?php echo base_url() ?>assets/img/loadwhite.svg" id="loadingExcluir" style="display:none">                            <span id="excluirReceitaspan">Excluir</span>                        </button>                    </div>                </form>            </div>        </div>    </div></div><div id="validarModal" class="modal fade in" role="dialog">    <div class="modal-dialog modal-lg">        <div class="modal-content">            <div class="modal-header">                <button type="button" class="close" data-dismiss="modal">&times;</button>                <h2 class="modal-title">Erro ao submeter as informações</h2>            </div>            <div class="clearfix modal-body container_forms">                <div id="validarModalMsg"></div>            </div>        </div>    </div></div><div style="margin-top: 6.5%; z-index: 3">    <button id="excluirbtn" type="button" style="background: #fc4c4c !important; outline: 0;" class="btn btn-danger btn-circle shadow btn-lg"><i class="fa fa-trash-o"></i></button></div><div id="exibealert" style="z-index: 2; display: none; position:fixed; top:50px; right: 90px;" class="alert alert-dismissable fade in"></div><script>    $(function () {        receitas();        //cadastra a receita        $('#save').click(function () {            event.preventDefault();            var formData = new FormData($('#receitasForm')[0]);            $('#enviar').html('');            $('#save').prop("disabled", true);            $('#loading').show();            $.ajax({                type: 'post',                url: $('#receitasForm').attr('action'),                data: formData,                async: true,                dataType: 'json',                contentType: false,                processData: false,                success: function (response) {                    window.setTimeout(function () {                        $('#loading').hide();                        $('#save').removeAttr('disabled');                        $('#enviar').html('Enviar');                    }, 1000);                    if (response[0] == false) {                        $('#validarModalMsg').html(response[1]);                        $('#validarModal').modal('toggle');                    } else {                        window.setTimeout(function () {                            $('#exibealert').addClass(response[0]).html(response[1]).fadeTo(50, 1);                            //tweaks para limpar o form após ajax (somente se a validação foi bem sucedida)                            $("#clearbtn").click();                            $("#ingredientes").trigger('change');                            $("#tempocoz").trigger('change');                            $("#porcoes").trigger('change');                        }, 1000);                        window.setTimeout(function () {                            $("#exibealert").slideUp();                            window.setTimeout(function () {                                $('#exibealert').removeClass(response[0]).html('').fadeTo(50, 1);                            }, 500);                        }, 4000);                    }                },                error: function (response) {                    console.log(response);                }            });        });        //remove os campos validados do modal        $('#validarModal').on('hidden.bs.modal', function () {            $('#validarModalMsg').html('');        });        function receitas() {            $('#receitas').DataTable({                "language": {                    "url": "<?php echo base_url() ?>vendors/datatables.net/traducao/pt_br.lang"                },                "ajax": {                    "type": "ajax",                    "url": "<?php echo base_url() ?>receitas/exibir_all",                    "dataSrc": function (json) {                        return json.data;                    }                },                "columns": [                    {"data": "id"},                    {"data": "imagem"},                    {"data": "nome"},                    {"data": "ingredientes"},                    {"data": "tempodecozimento"},                    {"data": "porcoes"},                    {"data": "descricao"}                ],                'select': {                    'style': 'multi'                },                "columnDefs": [                    {                        "targets": [0], 'checkboxes': {'selectRow': true}                    },                    {                        "targets": [1],                        "visible": true,                        "searchable": false,                        "data": "img",                        "render": function (imagem) {                            return '<img height="100px" width="130px" src="<?php echo base_url("assets/img/receitas/") ?>' + imagem + '"/>';                        }                    }                ],                "order": [[2, "asc"]]            });        }        $('#excluirbtn').click(function () {            var rows_selected = $('#receitas').DataTable().column(0).checkboxes.selected().join(",").split(",");            //console.log(rows_selected);            if (rows_selected[0] == "") {                $('#excluirbtn').prop("disabled", true);                $('#exibealert').addClass('alert-danger').html('<strong>Erro!</strong> Nenhuma receita selecionada.').fadeTo(50, 1);                window.setTimeout(function () {                    $('#excluirbtn').removeAttr("disabled");                    $("#exibealert").slideUp();                    window.setTimeout(function () {                        $('#exibealert').removeClass('alert-danger').html('').fadeTo(50, 1);                    }, 500);                }, 4000);            } else {                $('#excluirinput').val(rows_selected);                $.ajax({                    type: 'ajax',                    method: 'get',                    url: '<?php echo site_url() ?>receitas/exibirExcluir',                    data: $('#excluirForm').serialize(),                    async: true,                    success: function (response) {                        var dados = $.map(JSON.parse(response), function (el) {                            return el;                        });                        var i = 0;                        for (i = 0; i < dados.length; i++) {                            $('#nomeExcluir ul').append(                                    $('<li style="list-style-type: none;">').append(                                    $('<span>').append(dados[i]['nome'])                                    ));                        }                    }                });                $('#receitas').DataTable().destroy();                receitas();                $('#excluirReceita').modal('toggle');            }        });        $('#excluirReceita').on('hidden.bs.modal', function () {            $('#nomeExcluir ul').children("li").remove();        });        $(function () {            $('#excluirReceitabtn').click(function () {                event.preventDefault();                $('#excluirReceitaspan').html('');                $('#excluirReceitabtn').prop("disabled", true);                $('#loadingExcluir').show();                $.ajax({                    type: 'ajax',                    method: 'post',                    url: $('#excluirForm').attr('action'),                    data: $('#excluirForm').serialize(),                    async: true,                    dataType: 'json',                    success: function (response) {                        $('#receitas').DataTable().destroy();                        receitas();                        window.setTimeout(function () {                            $('#loadingExcluir').hide();                            $('#excluirReceita').modal('toggle');                            $('#excluirReceitabtn').removeAttr('disabled');                            $('#excluirReceitaspan').html('Excluir');                            $('#exibealert').addClass(response[0]).html(response[1]).fadeTo(50, 1);                            window.setTimeout(function () {                                $("#exibealert").slideUp();                                window.setTimeout(function () {                                    $('#exibealert').removeClass(response[0]).html('').fadeTo(50, 1);                                }, 500);                            }, 4000);                        }, 1000);                    },                    error: function (response) {                        console.log(response);                    }                });            });        });    });</script>